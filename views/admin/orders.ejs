<!DOCTYPE html>
<html lang="en" class="light">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Yadro - Orders</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="/js/toggle.js"></script>
  <link rel="icon" href="/images/logo.png" type="image/x-icon">
  <link rel="stylesheet" href="/css/orders.css">
  <style>
    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .fade-in-up {
      animation: fadeInUp 0.5s ease-out;
    }

    .status-dropdown {
      appearance: none;
      background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");
      background-position: right 0.5rem center;
      background-repeat: no-repeat;
      background-size: 1.5em 1.5em;
      padding-right: 2.5rem;
    }
  </style>
</head>

<body class="bg-gray-100 font-sans transition-all duration-300 dark:bg-gray-800">
  <div class="flex">
    <!-- Sidebar placeholder -->
    <%- include('../layouts/admin-sidebar.ejs') %>

    <!-- Main Content -->
    <div class="flex-1 p-8 ml-64">
      <div class="flex justify-between items-center mb-8">
        <h2 class="text-3xl font-bold text-gray-800 dark:text-white">Orders</h2>
        <div class="theme-toggle" id="themeToggle"></div>
      </div>

      <!-- Order Statistics -->
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-8 fade-in-up">
        <div class="bg-white dark:bg-gray-700 p-6 rounded-lg shadow-lg transition-all duration-300 hover:shadow-xl">
          <div class="flex items-center justify-between">
            <div>
              <h3 class="text-lg font-semibold text-gray-600 dark:text-gray-300">Pending Payment</h3>
              <p class="text-3xl font-bold text-blue-500">56</p>
            </div>
            <i class="fas fa-clock text-4xl text-blue-400"></i>
          </div>
        </div>
        <div class="bg-white dark:bg-gray-700 p-6 rounded-lg shadow-lg transition-all duration-300 hover:shadow-xl">
          <div class="flex items-center justify-between">
            <div>
              <h3 class="text-lg font-semibold text-gray-600 dark:text-gray-300">Completed</h3>
              <p class="text-3xl font-bold text-green-500">4873</p>
            </div>
            <i class="fas fa-check-circle text-4xl text-green-400"></i>
          </div>
        </div>
        <div class="bg-white dark:bg-gray-700 p-6 rounded-lg shadow-lg transition-all duration-300 hover:shadow-xl">
          <div class="flex items-center justify-between">
            <div>
              <h3 class="text-lg font-semibold text-gray-600 dark:text-gray-300">Refunded</h3>
              <p class="text-3xl font-bold text-yellow-500">231</p>
            </div>
            <i class="fas fa-undo text-4xl text-yellow-400"></i>
          </div>
        </div>
        <div class="bg-white dark:bg-gray-700 p-6 rounded-lg shadow-lg transition-all duration-300 hover:shadow-xl">
          <div class="flex items-center justify-between">
            <div>
              <h3 class="text-lg font-semibold text-gray-600 dark:text-gray-300">Failed</h3>
              <p class="text-3xl font-bold text-red-500">23</p>
            </div>
            <i class="fas fa-times-circle text-4xl text-red-400"></i>
          </div>
        </div>
      </div>

      <!-- Order Filters -->
      <div class="flex flex-wrap gap-2 mb-6 fade-in-up" style="animation-delay: 0.2s;">
        <button class="px-4 py-2 bg-blue-500 text-white rounded-full shadow hover:bg-blue-600 transition-colors duration-300">
          <i class="fas fa-list-ul mr-2"></i>All Status
        </button>
        <button class="px-4 py-2 bg-gray-200 text-gray-700 rounded-full shadow hover:bg-gray-300 transition-colors duration-300">
          <i class="fas fa-cog mr-2"></i>Ordered
        </button>
        <button class="px-4 py-2 bg-gray-200 text-gray-700 rounded-full shadow hover:bg-gray-300 transition-colors duration-300">
          <i class="fas fa-truck mr-2"></i>Shipped
        </button>
        <button class="px-4 py-2 bg-gray-200 text-gray-700 rounded-full shadow hover:bg-gray-300 transition-colors duration-300">
          <i class="fas fa-box mr-2"></i>Delivered
        </button>
        <button class="px-4 py-2 bg-gray-200 text-gray-700 rounded-full shadow hover:bg-gray-300 transition-colors duration-300">
          <i class="fas fa-ban mr-2"></i>Cancelled
        </button>
      </div>

      <!-- Orders Table -->
      <div class="bg-white dark:bg-gray-700 rounded-lg shadow-lg overflow-hidden">
        <table class="min-w-full table-auto">
          <thead class="bg-gray-50 dark:bg-gray-600 text-gray-600 dark:text-gray-200 uppercase text-sm leading-normal">
            <tr>
              <th class="py-3 px-6 text-left">Order ID</th>
              <th class="py-3 px-6 text-left">Customer</th>
              <th class="py-3 px-6 text-left">Order Date</th>
              <th class="py-3 px-6 text-left">Address</th> <!-- Update this section -->
              <th class="py-3 px-6 text-left">Payment</th>
              <th class="py-3 px-6 text-left">Total</th>
              <th class="py-3 px-6 text-left">Status</th>
              <th class="py-3 px-6 text-left">Action</th>
            </tr>
          </thead>
          <tbody class="text-gray-600 dark:text-gray-200 text-sm font-light">
            <% orders.forEach(order => { %>
            <tr class="border-b dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600">
              <td class="py-3 px-6 font-medium"><%= order._id %></td>
              <td class="py-3 px-6"> <%= order.userId.fname %> <%= order.userId.lname %></td>
              <td class="py-3 px-6"><%= order.orderDate.toDateString() %></td>
              <td class="py-3 px-6">
                <% if (order.deliveryAddress && order.deliveryAddress.address && order.deliveryAddress.address.length > 0) { %>
                <% const address = order.deliveryAddress.address[0]; %>
                <%= address.name %>, <%= address.streetAddress %>, <%= address.city %>, <%= address.state %>, <%= address.country %>, <%= address.postalCode %>
                <% } else { %>
                No delivery address available
                <% } %>
              </td>
              <td class="py-3 px-6"><%= order.paymentMethod %></td>
              <td class="py-3 px-6">â‚¹ <%= order.totalAmount %></td>
              <td class="py-3 px-6">
                <form action="/admin/orders/update-status" method="POST">
                  <input type="hidden" name="orderId" value="<%= order._id %>">
                  <select name="status" class="status-dropdown py-1 px-3 rounded-full text-xs border-2">
                    <option value="Ordered" <%= order.orderStatus === 'Ordered' ? 'selected' : '' %>>Ordered</option>
                    <option value="Shipped" <%= order.orderStatus === 'Shipped' ? 'selected' : '' %>>Shipped</option>
                    <option value="Out For Delivery" <%= order.orderStatus === 'Out For Delivery' ? 'selected' : '' %>>Out For Delivery</option>
                    <option value="Delivered" <%= order.orderStatus === 'Delivered' ? 'selected' : '' %>>Delivered</option>
                    <option value="Cancelled" <%= order.orderStatus === 'Cancelled' ? 'selected' : '' %>>Cancelled</option>
                  </select>
                  <button type="submit" class="ml-2 text-blue-500">Update</button>
                </form>
              </td>
              <td class="py-3 px-6">
                <a href="/admin/orders/edit/<%= order._id %>" class="text-blue-500 hover:text-blue-700">
                  <i class="fas fa-edit mr-1"></i>Edit
                </a>
              </td>
            </tr>
            <% }) %>
          </tbody>
        </table>
      </div>

      <!-- Pagination -->
      <div class="flex justify-center mt-6 fade-in-up" style="animation-delay: 0.6s;">
        <nav class="inline-flex rounded-md shadow-sm">
          <button class="px-3 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50">
            <i class="fas fa-chevron-left"></i>
          </button>
          <button class="px-3 py-2 border-t border-b border-gray-300 bg-white text-sm font-medium text-blue-600 hover:bg-blue-50">1</button>
          <button class="px-3 py-2 border-t border-b border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50">2</button>
          <button class="px-3 py-2 border-t border-b border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50">3</button>
          <button class="px-3 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50">
            <i class="fas fa-chevron-right"></i>
          </button>
        </nav>
      </div>
    </div>
  </div>

  <script src="/js/orders.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', (event) => {
      const statusDropdowns = document.querySelectorAll('.status-dropdown');

      statusDropdowns.forEach(dropdown => {
        const updateDropdownStyle = () => {
          const selectedOption = dropdown.options[dropdown.selectedIndex];
          dropdown.style.backgroundColor = selectedOption.style.backgroundColor;
          dropdown.style.color = selectedOption.style.color;
          dropdown.style.borderColor = selectedOption.style.color;
        };

        // Set initial style
        updateDropdownStyle();

        // Update style when selection changes
        dropdown.addEventListener('change', updateDropdownStyle);
      });
    });
  </script>
</body>

</html>